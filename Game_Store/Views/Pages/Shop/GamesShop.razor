@page "/shop"

@inject GameController Controller
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider

<PageTitle>Game Catalog</PageTitle>

@if (games == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <div class="container">
        <div class="d-flex justify-content-start">
            <a class="d-flex align-items-start flex-column bd-highlight mb-3 btn btn-primary me-2" role="button" href="/donate">
                <i class="fa-solid fa-house-medical"></i>
                <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> Donated
            </a>     
            <a class="d-flex align-items-start flex-column bd-highlight mb-3 btn btn-secondary me-2" role="button" href="/purchasehistory">
                <i class="fa-solid fa-house-medical"></i>
                <span class="bi bi-house-door-fill-nav-menu" aria-hidden="true"></span> History
            </a>
        </div>

        <table class="table table-striped table-bordered table-hover mt-2">
            <thead class="table-dark">
            <th>GameId</th>
            <th>Name</th>
            <th>Genres</th>
            <th class="text-end">Price</th>
            <th>Release Date</th>
            <th>Actions</th>
            </thead>
            <tbody>
            @foreach (var game in games)
            {
                <tr>
                    <td>@game.GameId</td>
                    <td>@game.Name</td>
                    <td>@game.Genre?.Name</td>
                    <td class="text-end">@game.Price.ToString("C2")</td>
                    <td>@game.ReleaseDate</td>
                    <td>
                        <div class="d-flex">
                            <a class="btn btn-primary me-2" role="button" href="@ShopUrl(game.GameId)">
                                <i class="bi bi-bag"></i>
                            </a>
                        </div>
                        
                        <!--<AuthorizeView>
                            <Authorized>
                                <button class="btn btn-success" @onclick="() => BuyGames(game.GameId)">
                                    Buy
                                </button>
                            </Authorized>
                            <NotAuthorized>
                                <button class="btn btn-success" disabled>
                                    Login to Buy
                                </button>
                            </NotAuthorized>
                        </AuthorizeView>-->
                    </td>
                </tr>
            }
        </tbody>
        </table>
    </div>
}

@code {
    private IEnumerable<GameSummary> games;

    protected override async Task OnInitializedAsync()
    {
        games = await Controller.GetGamesAsync();
    }

    private static string ShopUrl(int id) => $"/buygame/{id}";

    /*private void BuyGames(int gameId)
    {
        NavigationManager.NavigateTo($"/buygame/{gameId}");
    }*/
}
